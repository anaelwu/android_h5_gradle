/* Meiya 2016-05-26 10:47 */!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=function(){},e=function(a,b){if(a){var c=this;if("object"==typeof b)for(var d in b)this[d]=b[d];var e=a.dataset,f=e.countdown_format,g=e.countdown_time_color,h=e.countdown_text_color;e.countdown_handler||(e.countdown_handler=setInterval(function(){var b=Number(e.countdown_time),d=Number(e.countdown_limit);if(isNaN(b)||0>=b)return clearInterval(e.countdown_handler),delete e.countdown_handler,void(0>=b&&c.onEnd(a));if(e.countdown_time=--b,d){if(b>=d)return;c.onLimit(a),delete e.countdown_limit}a.innerHTML=c.timeFormat(e.countdown_time,f,g,h)},1e3))}};e.prototype={constructor:e,onLimit:d,onEnd:d,timeFormat:function(a,b,c,d){b=b||"";var e=function(a){return a>0?(9>=a&&(a="0"+a),String(a)):"00"},f={s:"00",m:"00",h:"00",d:"00",M:"00",y:"0"};return a>0&&(f.s=e(a%60),f.m=Math.floor(a/60)>0?e(Math.floor(a/60)%60):"00",f.h=Math.floor(a/3600)>0?e(Math.floor(a/3600)%24):"00",f.d=Math.floor(a/86400)>0?e(Math.floor(a/86400)%30):"00"),/#(\w+)/.test(c)||(c="#f868a1"),/#(\w+)/.test(d)||(d="#7b5da6"),b='<i class="t" style="color: '+c+'">'+f.d+'</i><i class="w" style="color: '+d+'">天</i><i class="t" style="color: '+c+'">'+f.h+'</i><i class="w" style="color: '+d+'">时</i><i class="t" style="color: '+c+'">'+f.m+'</i><i class="w" style="color: '+d+'">分</i><i class="t" style="color: '+c+'">'+f.s+'</i><i class="w" style="color: '+d+'">秒</i>'}},b.exports=e},{}],2:[function(a,b,c){"use strict";var d=a("../../public/src/utils/zepto.lazyload"),e=a("../../public/src/ui/zepto.loading"),f=a("./tpl/template.js"),g=a("./tpl/live.js"),h=a("./tpl/video.js"),i=a("./tpl/notes.js"),j=a("./common/countdown"),k=a("es6-promise"),l=k.Promise,m=a("./tpl/comment.js"),n=(a("./tpl/comment-list.js"),new e),o=MY.appBridge,p=$(".container"),q=$("#J_Live"),r=$("#J_Video"),s=$("#J_Notes"),t=$("#J_Comment");f.helper("dateFormat",MY.dateFormat),f.helper("myDate",function(a,b){var c=(new Date).getTime(),d=new Date(1e3*a),e=864e5,f=1728e5,g=2592e5,h=c-14516064e5,i={y:d.getFullYear(),M:d.getMonth()>8?d.getMonth()+1:"0"+(d.getMonth()+1),d:d.getDate()>9?d.getDate():"0"+d.getDate(),h:d.getHours()>9?d.getHours():"0"+d.getHours(),m:d.getMinutes()>9?d.getMinutes():"0"+d.getMinutes()};return b=e>c-1e3*a?i.h+":"+i.m:f>c-1e3*a?"昨天"+i.h+":"+i.m:g>c-1e3*a?"前天"+i.h+":"+i.m:h>c-1e3*a?i.M+"-"+i.d+" "+i.h+":"+i.m:i.Y+"-"+i.M+"-"+i.d+" "+i.h+":"+i.m}),f.helper("notes",function(a,b){return/\>Q/.test(a)&&(a=a.replace(">Q",'><i class="q"></i>')),/\>A/.test(a)&&(a=a.replace(">A",'><i class="a"></i>')),a});var u={id:0,user_id:0,live_id:0,init:function(){var a=this;o.callHandler("get_user_id",function(b){a.user_id=b.user_id?+b.user_id:0}),o.callHandler("get_query_string",function(b){var c=b.query_string;c.match(/id=(\d+)/),a.id=RegExp.$1,a.id&&(u.live.init(),u.comment.event(),u.notes.event(),$(window).scroll(function(a){var b=$("body"),c=b.scrollTop(),d=b.height(),e=$(window).height();if(100>d-c-e&&u.live.data)if(t.html()){if(u.comment.isLoading)return;u.comment.isLoading=!0,u.comment.page+=1,u.comment.init()}else if(s.html()){if(u.notes.isLoading)return;u.notes.isLoading=!0,u.notes.page+=1,u.notes.init()}}))})}};u.live={data:{},load:function(){var a=this,b=new l(function(b,c){MY.xhr.api({url:"/v1/live-rooms/"+u.id,type:"get",data:{with_past_count:10},success:function(c){return-400==c.code?(o.callHandler("my_toast",{delay:2,content:"获取不到该直播数据~"}),void n.hide()):(u.live_id=c.data.id,a.data=c.data,a.timestamp=c.timestamp,void b(a.data))}})});return b},init:function(){var a=this;this.load().then(function(){a.render()})},render:function(){var a=this,b=window.localStorage.getItem("live_notice")?JSON.parse(window.localStorage.getItem("live_notice")):{},c=!1;b&&b[u.id]==u.user_id&&(c=!0),q.html(g({data:a.data,time:MY.dateFormat(1e3*a.data.start_time,"M月d日"),timestamp:a.timestamp,user_id:u.user_id,live_id:u.live_id,version:MY.Version(MY.version,"2.9.0")>=0,aday:86400,ahour:3600,fmin:300,isNotice:c})),u.live.countdown(),u.live.event(a.data),n.hide(),u.video.render(a.data.pass_live_rooms),0==a.data.status?u.comment.init():(u.user_id==a.data.user_id&&u.comment.init(),3==a.data.status&&(u.notes.order=0,r.appendTo(p)),u.notes.init())},countdown:function(){new j(document.getElementById("J_Countdown"),{onEnd:function(a){u.live.init()}})},event:function(a){function b(b){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){var b=$("#J_Button"),c=$("#J_Info");b.delegate("a","click",function(){var b=$(this),c=b.data("url");c&&(b.hasClass("btn-play")?u.postStats("live_play_click"):u.postStats("live_replay_click"),c+="?portrait="+a.portrait,u.user_id?o.callHandler("navi_page_action",c):u.login()),b.hasClass("btn-share")&&o.callHandler("share_channel_action",{default_share:{title:a.title,content:a.title,url:MY.locationOrigin+"/web/live.html?id="+a.id,image_url:a.cover_image_url}}),b.hasClass("btn-update")&&o.callHandler("check_version_upgrade");var d=window.localStorage.getItem("live_notice")?JSON.parse(window.localStorage.getItem("live_notice")):{};return b.hasClass("btn-notice")&&d&&d[u.live_id]==u.user_id?void o.callHandler("my_toast",{delay:1,content:"已设置提醒啦"}):void(b.hasClass("btn-notice")&&!b.hasClass("btn-lock")&&(u.postStats("live_notice_click"),u.user_id?(o.callHandler("local_notification",{time:a.start_time-300,text:"美芽"+a.user.username+"的直播还有5分钟就要开始啦，快搬好板凳看直播",url:"local://live/index.html?enable_refresh=1&id="+a.id}),o.callHandler("my_toast",{delay:1,content:"提醒成功"}),d[u.live_id]=u.user_id,window.localStorage.setItem("live_notice",JSON.stringify(d)),b.addClass("btn-lock"),b.html("已设置提醒"),MY.xhr.post("/api/live-rooms/remind",{live_room_id:u.id})):u.login()))}),c.delegate("a","click",function(a){var b=$(this),c=b.attr("href");/meiya:\/\//.test(c)?(event.preventDefault(),o.callHandler("navi_page_action",c)):/local:\/\//.test(c)&&(event.preventDefault(),o.callHandler("navi_webview_action",c))}),p.delegate(".J_Webview","tap",function(){var a=$(this),b=a.data("url");b&&o.callHandler("navi_webview_action",b)}),o.registerHandler("call_share_channel_action",function(){o.callHandler("share_channel_action",{default_share:{title:a.title,content:a.title,url:MY.locationOrigin+"/web/live.html?id="+a.id,image_url:a.cover_image_url}})})})},u.video={render:function(a){var b=this;r.html(h({data:a}));var c=$("#wrapper"),e=5;$.each(c.find(".item"),function(a,b){e+=$(b).width()}),c.find("ul").css("width",e),b.event(),setTimeout(function(){new d(".J_LazyPic",{container:"#wrapper"})},100)},event:function(){var a=$("#wrapper");a.delegate(".item","tap",function(){var a=$(this),b=a.data("page");b&&o.callHandler("navi_webview_action",b)})}},u.comment={page:1,isPosting:!1,isLoading:!1,load:function(){var a=this,b=new l(function(b,c){MY.xhr.api({url:"/v2/comments/live-rooms",type:"get",data:{page:a.page,per_page:20,live_room_id:u.id},success:function(c){a.data=c.data,b(c.data)},error:function(a){c(a)}})});return b},init:function(){var a=this;t.find(".box").append($('<div class="J_Loading loading"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>')),this.load().then(function(){a.render()})},render:function(){var a=m({page:this.page,data:this.data,author:u.user_id==u.live.data.user_id?!0:!1});if(t.find(".J_Loading").remove(),this.data.length)this.isLoading=!1;else{if(t.find(".end").length)return;t.find(".box").append($('<div class="end">没有更多内容啦</div>'))}1==this.page?t.html(a):t.find(".comments").append(a)},event:function(){var a=this;t.delegate("#J_CommentForm","submit",function(b){b.preventDefault();var c=$(".comment-box"),d=c.val();d.trim()&&!a.isPosting&&(u.user_id?(a.isPosting=!0,a.post(d.trim()).then(function(b){return-100==b.code?void o.callHandler("my_toast",{delay:1,content:b.message}):(o.callHandler("my_toast",{delay:1,content:"提问成功"}),c.val(""),c.blur(),a.isPosting=!1,void setTimeout(function(){a.page=1,a.init()},100))})):u.login())}),t.delegate(".btn","tap",function(){var a=$(this),b=+a.html(),c=a.data("id");a.hasClass("btn-liked")||(u.user_id?(a.addClass("btn-liked"),a.html(b+1),MY.xhr.api({url:"/v1/likes",type:"post",data:{likeable_type:"Comment",likeable_id:c},success:function(b){var c=b.data;c.like_count&&a.html(c.like_count)}})):u.login())})},post:function(a){var b=new l(function(b,c){MY.xhr.api({url:"/v1/comments",type:"post",data:{commentable_type:"LiveRoom",commentable_id:u.id,content:a},success:function(a){b(a)},error:function(a){c(a)}})});return b}},u.notes={order:1,page:1,isLoading:!1,load:function(){var a=this,b=new l(function(b,c){MY.xhr.api({url:"/v1/live-notes",type:"get",data:{page:a.page,per_page:20,live_room_id:u.id,order_by_publish_time:a.order},success:function(c){a.data=c.data,b(c.data)},error:function(a){c(a)}})});return b},init:function(){var a=this;3!=u.live.data.status&&s.find(".box").append($('<div class="J_Loading loading"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>')),this.load().then(function(){a.render()})},render:function(){var a=i({data:this.data,page:this.page,status:u.live.data.status});s.find(".J_Loading").remove(),this.data.length&&(this.isLoading=!1,1==this.page?s.html(a):s.find(".content").append(a))},event:function(){var a=setInterval(function(){return 0==u.live.data.status||3==u.live.data.status?void clearInterval(a):(u.notes.page=1,void u.notes.init())},3e4)}},u.login=function(){o.callHandler("request_login");var a=setInterval(function(){o.callHandler("get_user_id",function(b){b.user_id&&"0"!=b.user_id&&(u.init(),clearInterval(a))})},500)},u.postStats=function(a,b,c,d){if(a&&"string"==typeof a){var e={event:a,object_id:b||u.id};return c&&(e.type=c),d&&(e.value=d),MY.xhr.api({type:"post",url:"/v1/stats",data:e})}},u.init(),o.registerHandler("webview_will_appear",function(){setTimeout(function(){u.live.init()},500)})},{"../../public/src/ui/zepto.loading":11,"../../public/src/utils/zepto.lazyload":15,"./common/countdown":1,"./tpl/comment-list.js":3,"./tpl/comment.js":4,"./tpl/live.js":5,"./tpl/notes.js":6,"./tpl/template.js":7,"./tpl/video.js":8,"es6-promise":9}],3:[function(a,b,c){"use strict";var d=a("./template");b.exports=d("comment-list",function(a){var b=this,c=b.$helpers,d=b.$each,e=a.data,f=(a.item,a.$index,b.$string),g="";return d(e,function(a){g+=' <li class="item"> <div class="avatar"> ',a.user.avatar_url?(g+=' <img src="',g+=f(a.user.avatar_url),g+='"> '):g+=' <img src="public/img/avatar_url.png"> ',g+=' </div> <div class="comment-content"> <div class="userinfo"> <span class="username">',g+=f(a.user.username),g+='</span> <span class="meta">',g+=f(c.myDate(a.created_time)),g+='</span> </div> <div class="data">',g+=f(a.content),g+='</div> <a class="btn btn-like',a.like_id&&(g+=" btn-liked"),g+="\" data-id='",g+=f(a.id),g+="'>",g+=f(a.like_count),g+="</a> </div> </li> "}),new String(g)})},{"./template":7}],4:[function(a,b,c){"use strict";var d=a("./template");b.exports=d("comment",function(a){var b=this,c=b.$helpers,d=a.page,e=a.author,f=b.$each,g=a.data,h=(a.item,a.$index,b.$string),i="";return 1==d&&(i+=' <section class="box comment"> <div class="title">向主播提问<span class="sub-title">',i+=e?"请务必回答赞数前三的问题":"赞数前三的问题，主播一定解答哦",i+='</span></div> <div class="content"> <form class="form" id=\'J_CommentForm\' action=""> <input type="text" class="comment-box" placeholder="你有什么想问主播的"> </form> <ul class="comments"> '),i+=" ",f(g,function(a){i+=' <li class="item"> <div class="avatar"> ',a.user.avatar_url?(i+=' <img src="',i+=h(a.user.avatar_url),i+='"> '):i+=' <img src="public/img/avatar_url.png"> ',i+=' </div> <div class="comment-content"> <div class="userinfo"> <span class="username">',i+=h(a.user.username),i+='</span> <span class="meta">',i+=h(c.myDate(a.created_time)),i+='</span> </div> <div class="data">',i+=h(a.content),i+='</div> <a class="btn btn-like',a.like_id&&(i+=" btn-liked"),i+="\" data-id='",i+=h(a.id),i+="'>",i+=h(a.like_count),i+="</a> </div> </li> "}),i+=" ",1==d&&(i+=" </ul> </div> </section> "),new String(i)})},{"./template":7}],5:[function(a,b,c){"use strict";var d=a("./template");b.exports=d("live",function(a){var b=this,c=(b.$helpers,b.$string),d=a.data,e=a.timestamp,f=a.aday,g=a.time,h=a.version,i=a.user_id,j=a.fmin,k=a.isNotice,l="";return l+='<section class="player"> <img src="',l+=c(d.poster_url),l+='?imageView2/2/w/750"> <div class="status"> ',0==d.status?(l+=" ",d.start_time-e>f?(l+=' <p class="text"',d.countdown_text_color&&(l+=' style="color: ',l+=c(d.countdown_text_color),l+='"'),l+=">离",l+=c(g),l+="直播开始还有</p> "):(l+=' <p class="text"',d.countdown_text_color&&(l+=' style="color: ',l+=c(d.countdown_text_color),l+='"'),l+=">离直播开始还有</p> "),l+=' <p class="time" id=\'J_Countdown\' data-countdown_time="',l+=c(d.start_time-e),l+="\" data-countdown_time_color='",l+=c(d.countdown_time_color),l+="' data-countdown_text_color='",l+=c(d.countdown_text_color),l+="'></p> "):1==d.status?(l+=' <p class="text"',d.countdown_text_color&&(l+=' style="color: ',l+=c(d.countdown_text_color),l+='"'),l+='>正在直播</p> <p class="playing"></p> '):2==d.status?(l+=' <p class="text"',d.countdown_text_color&&(l+=' style="color: ',l+=c(d.countdown_text_color),l+='"'),l+='>直播已暂停</p> <p class="stop"></p> '):3==d.status&&(l+=' <p class="text"',d.countdown_text_color&&(l+=' style="color: ',l+=c(d.countdown_text_color),l+='"'),l+='>直播已结束</p> <p class="stop"></p> '),l+=" </div> <div id='J_Button' class=\"button\"> ",h?(l+=" ",i==d.user_id?(l+=" ",3!=d.status?(l+=" <a id='J_BtnLive' class=\"btn btn-live\" data-url='meiya://live-record/",l+=c(d.id),l+="'>开始直播</a> "):(l+=" ",1==d.video_status?(l+=" <a id='J_BtnReplay' class=\"btn btn-replay\" data-url='meiya://live-replay/",l+=c(d.id),l+="'>回放视频</a> "):l+=' <a class="btn btn-disabled">正在处理回放视频</a> ',l+=" "),l+=" "):(l+=" ",0==d.status?(l+=" ",d.start_time-e>j?(l+=" ",l+=k?" <a id='J_BtnNotice' class=\"btn btn-notice btn-lock\">已设置提醒</a> ":" <a id='J_BtnNotice' class=\"btn btn-notice\">开播提醒</a> ",l+=" "):d.start_time-e<=j&&d.start_time-e>=0&&(l+=' <a class="btn btn-notice btn-lock">即将开始</a> '),l+=" "):1==d.status?(l+=" ",65==d.id&&(l+=" <a class=\"btn btn-link J_Webview\" data-url='http://www.douyu.com/613388'>斗鱼同步直播</a> "),l+=" <a id='J_BtnPlay' class=\"btn btn-play\" data-url='meiya://live/",l+=c(d.id),l+="'>进入直播</a> "):2==d.status?l+=' <a class="btn btn-disabled">暂停直播</a> ':3==d.status&&(l+=" ",1==d.video_status?(l+=" <a id='J_BtnReplay' class=\"btn btn-replay\" data-url='meiya://live-replay/",l+=c(d.id),l+="'>回放视频</a> "):l+=' <a class="btn btn-disabled">正在处理回放视频</a> ',l+=" "),l+=" "),l+=" "):l+=" <a id='J_BtnUpdate' class=\"btn btn-update\">升级新版本，观看直播</a> ",l+=" </div> </section> ",i==d.user_id&&(l+=" ",d.user_description&&(l+=' <section class="box anchor"> <div class="title">主播必看</div> <div class="content">',l+=c(d.user_description),l+="</div> </section> "),l+=" "),new String(l)})},{"./template":7}],6:[function(a,b,c){"use strict";var d=a("./template");b.exports=d("notes",function(a){var b=this,c=b.$helpers,d=a.page,e=a.status,f=b.$each,g=a.data,h=(a.item,a.i,b.$string),i="";return 1==d&&(i+=' <section class="box notes"> <div class="title">',i+=3==e?"直播笔记":"文字直播",i+='</div> <div class="content"> '),i+=" ",f(g,function(a){i+=' <div class="item">',i+=h(c.notes(a.content)),3!=e&&(i+='<span class="meta">',i+=h(c.myDate(a.created_time)),i+="</span>"),i+="</div> "}),i+=" ",1==d&&(i+=" </div> </section> "),new String(i)})},{"./template":7}],7:[function(a,b,c){"use strict";!function(){function a(a,b){return(/string|function/.test(typeof b)?i:h)(a,b)}function c(a,b){return"string"!=typeof a&&(b=typeof a,"number"===b?a+="":a="function"===b?c(a.call(a)):""),a}function d(a){return m[a]}function e(a){return c(a).replace(/&(?![\w#]+;)|[<>"']/g,d)}function f(a,b){if(n(a))for(var c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)}function g(a,b){var c=/(\/)[^\/]+\1\.\.\1/,d=("./"+a).replace(/[^\/]+$/,""),e=d+b;for(e=e.replace(/\/\.\//g,"/");e.match(c);)e=e.replace(c,"/");return e}function h(b,c){var d=a.get(b)||j({filename:b,name:"Render Error",message:"Template not found"});return c?d(c):d}function i(a,b){if("string"==typeof b){var c=b;b=function(){return new l(c)}}var d=k[a]=function(c){try{return new b(c,a)+""}catch(d){return j(d)()}};return d.prototype=b.prototype=o,d.toString=function(){return b+""},d}function j(a){var b="{Template Error}",c=a.stack||"";if(c)c=c.split("\n").slice(0,2).join("\n");else for(var d in a)c+="<"+d+">\n"+a[d]+"\n\n";return function(){return"object"==typeof console&&console.error(b+"\n\n"+c),b}}var k=a.cache={},l=window.String,m={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},n=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},o=a.utils={$helpers:{},$include:function(a,b,c){return a=g(c,a),h(a,b)},$string:c,$escape:e,$each:f},p=a.helpers=o.$helpers;a.get=function(a){return k[a.replace(/^\.\//,"")]},a.helper=function(a,b){p[a]=b},b.exports=a}()},{}],8:[function(a,b,c){"use strict";var d=a("./template");b.exports=d("video",function(a){var b=this,c=(b.$helpers,a.data),d=b.$each,e=(a.item,a.$index,b.$string),f="";return c.length&&(f+=' <section class="box video"> <div class="title">往期回放</div> <div class="content" id=\'wrapper\'> <ul> ',d(c,function(a){f+=" ",a.cover_image_url&&(f+=' <a class="item" data-page=\'live/index.html?enable_refresh=1&id=',f+=e(a.id),f+='\'> <img class="J_LazyPic" src="./img/lazy-bg.png" data-original="',f+=e(a.cover_image_url),f+='?imageView2/1/w/750/h/380"> </a> '),f+=" "}),f+=" </ul> </div> </section> "),new String(f)})},{"./template":7}],9:[function(a,b,c){(function(c,d){(function(){"use strict";function e(a){return"function"==typeof a||"object"==typeof a&&null!==a}function f(a){return"function"==typeof a}function g(a){T=a}function h(a){X=a}function i(){return function(){c.nextTick(n)}}function j(){return function(){S(n)}}function k(){var a=0,b=new $(n),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function l(){var a=new MessageChannel;return a.port1.onmessage=n,function(){a.port2.postMessage(0)}}function m(){return function(){setTimeout(n,1)}}function n(){for(var a=0;W>a;a+=2){var b=ba[a],c=ba[a+1];b(c),ba[a]=void 0,ba[a+1]=void 0}W=0}function o(){try{var b=a,c=b("vertx");return S=c.runOnLoop||c.runOnContext,j()}catch(d){return m()}}function p(a,b){var c=this,d=c._state;if(d===fa&&!a||d===ga&&!b)return this;var e=new this.constructor(r),f=c._result;if(d){var g=arguments[d-1];X(function(){H(d,e,g,f)})}else D(c,e,a,b);return e}function q(a){var b=this;if(a&&"object"==typeof a&&a.constructor===b)return a;var c=new b(r);return z(c,a),c}function r(){}function s(){return new TypeError("You cannot resolve a promise with itself")}function t(){return new TypeError("A promises callback cannot return that same promise.")}function u(a){try{return a.then}catch(b){return ha.error=b,ha}}function v(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function w(a,b,c){X(function(a){var d=!1,e=v(c,b,function(c){d||(d=!0,b!==c?z(a,c):B(a,c))},function(b){d||(d=!0,C(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,C(a,e))},a)}function x(a,b){b._state===fa?B(a,b._result):b._state===ga?C(a,b._result):D(b,void 0,function(b){z(a,b)},function(b){C(a,b)})}function y(a,b,c){b.constructor===a.constructor&&c===ca&&constructor.resolve===da?x(a,b):c===ha?C(a,ha.error):void 0===c?B(a,b):f(c)?w(a,b,c):B(a,b)}function z(a,b){a===b?C(a,s()):e(b)?y(a,b,u(b)):B(a,b)}function A(a){a._onerror&&a._onerror(a._result),E(a)}function B(a,b){a._state===ea&&(a._result=b,a._state=fa,0!==a._subscribers.length&&X(E,a))}function C(a,b){a._state===ea&&(a._state=ga,a._result=b,X(A,a))}function D(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+fa]=c,e[f+ga]=d,0===f&&a._state&&X(E,a)}function E(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?H(c,d,e,f):e(f);a._subscribers.length=0}}function F(){this.error=null}function G(a,b){try{return a(b)}catch(c){return ia.error=c,ia}}function H(a,b,c,d){var e,g,h,i,j=f(c);if(j){if(e=G(c,d),e===ia?(i=!0,g=e.error,e=null):h=!0,b===e)return void C(b,t())}else e=d,h=!0;b._state!==ea||(j&&h?z(b,e):i?C(b,g):a===fa?B(b,e):a===ga&&C(b,e))}function I(a,b){try{b(function(b){z(a,b)},function(b){C(a,b)})}catch(c){C(a,c)}}function J(a){return new oa(this,a).promise}function K(a){function b(a){z(e,a)}function c(a){C(e,a)}var d=this,e=new d(r);if(!V(a))return C(e,new TypeError("You must pass an array to race.")),e;for(var f=a.length,g=0;e._state===ea&&f>g;g++)D(d.resolve(a[g]),void 0,b,c);return e}function L(a){var b=this,c=new b(r);return C(c,a),c}function M(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function N(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function O(a){this._id=ma++,this._state=void 0,this._result=void 0,this._subscribers=[],r!==a&&("function"!=typeof a&&M(),this instanceof O?I(this,a):N())}function P(a,b){this._instanceConstructor=a,this.promise=new a(r),Array.isArray(b)?(this._input=b,this.length=b.length,this._remaining=b.length,this._result=new Array(this.length),0===this.length?B(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&B(this.promise,this._result))):C(this.promise,this._validationError())}function Q(){var a;if("undefined"!=typeof d)a=d;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(b){throw new Error("polyfill failed because global object is unavailable in this environment")}var c=a.Promise;(!c||"[object Promise]"!==Object.prototype.toString.call(c.resolve())||c.cast)&&(a.Promise=na)}var R;R=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var S,T,U,V=R,W=0,X=function(a,b){ba[W]=a,ba[W+1]=b,W+=2,2===W&&(T?T(n):U())},Y="undefined"!=typeof window?window:void 0,Z=Y||{},$=Z.MutationObserver||Z.WebKitMutationObserver,_="undefined"!=typeof c&&"[object process]"==={}.toString.call(c),aa="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ba=new Array(1e3);U=_?i():$?k():aa?l():void 0===Y&&"function"==typeof a?o():m();var ca=p,da=q,ea=void 0,fa=1,ga=2,ha=new F,ia=new F,ja=J,ka=K,la=L,ma=0,na=O;O.all=ja,O.race=ka,O.resolve=da,O.reject=la,O._setScheduler=g,O._setAsap=h,O._asap=X,O.prototype={constructor:O,then:ca,"catch":function(a){return this.then(null,a)}};var oa=P;P.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},P.prototype._enumerate=function(){for(var a=this.length,b=this._input,c=0;this._state===ea&&a>c;c++)this._eachEntry(b[c],c)},P.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,d=c.resolve;if(d===da){var e=u(a);if(e===ca&&a._state!==ea)this._settledAt(a._state,b,a._result);else if("function"!=typeof e)this._remaining--,this._result[b]=a;else if(c===na){var f=new c(r);y(f,a,e),this._willSettleAt(f,b)}else this._willSettleAt(new c(function(b){b(a)}),b)}else this._willSettleAt(d(a),b)},P.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===ea&&(this._remaining--,a===ga?C(d,c):this._result[b]=c),0===this._remaining&&B(d,this._result)},P.prototype._willSettleAt=function(a,b){var c=this;D(a,void 0,function(a){c._settledAt(fa,b,a)},function(a){c._settledAt(ga,b,a)})};var pa=Q,qa={Promise:na,polyfill:pa};"function"==typeof define&&define.amd?define(function(){return qa}):"undefined"!=typeof b&&b.exports?b.exports=qa:"undefined"!=typeof this&&(this.ES6Promise=qa),pa()}).call(this)}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:10}],10:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(a){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],11:[function(a,b,c){"use strict";var d={elem:".J_Loading",onshow:function(){},onhide:function(){}},e='<div class="J_Loading loading"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>',f=function(a){var b=null;a=$.extend(d,a||{}),$.extend(this,a),b=$(a.elem),0===b.length&&(b=$(e),document.body.appendChild(b[0])),this.$elem=b},g=f.prototype={constructor:f};$.extend(g,{show:function(){return this.$elem.show(),this.__dispatchEvent("show"),this},hide:function(){return this.$elem.hide(),this.__dispatchEvent("hide"),this},__dispatchEvent:function(a,b){this["on"+a]&&this["on"+a](b)},destory:function(){this.$elem.remove();for(var a in this)delete this[a];return this}}),b.exports=f},{}],12:[function(a,b,c){"use strict";function d(a){window.WebViewJavascriptBridge?a(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){a(WebViewJavascriptBridge)},!1)}function e(a,b,c){switch(a){case"share_channel_action":if(f.system.iPhone&&g.Version(f.app.ver,"2.3.0")<=0){var d=b.weibo;"object"==typeof d&&(d.title=d.title+d.url,d.content=d.content+d.url)}break;case"get_query_string":if("function"==typeof c){var e=location.search.replace(/^\?/,""),h=location.hash.replace(/^\#/,""),i=e+(e?"#":"")+h;f.system.iPhone&&-1===g.Version(f.app.ver,"2.7.0")?c({query_string:i}):f.system.Android&&-1===g.Version(f.app.ver,"2.3.0")&&c({query_string:i})}}}var f=a("./ua"),g=window.MY=window.MY||{},h={defaultHandler:function(a,b){b("got")},send:function(a,b){d(function(c){c.send(a,function(a){"function"==typeof b&&b(a)})})},callHandler:function(a,b,c){"function"==typeof b&&(c=b,b=null),e.call(null,a,b,c),d(function(d){d.callHandler(a,b,function(a){"function"==typeof c&&c(a)})})},registerHandler:function(a,b){d(function(c){c.registerHandler(a,function(a){"function"==typeof b&&b(a)})})}};d(function(a){a.init&&a.init&&a.init(h.defaultHandler)}),h.connectWebViewJavascriptBridge=d,g.appBridge=h,b.exports=h},{"./ua":14}],13:[function(a,b,c){"use strict";var d=a("./app-bridge"),e=function(){return this};e.prototype={constructor:e,onerror:function(a){var b=a.target.src;this.dataset.ip||e.queryIP(b).done(function(a,b){this.dataset.ip=a,this.src=this.src.replace(b,a)}.bind(this))}},e.queryIP=function(a){var b=$.Deferred(),c=/^https?:\/\/([^:\/\?#]+)/,e=a.match(c);if(e&&e.length){var f=e[1];d.callHandler("query_ip",{host:f},function(a){b.resolve(a.ip,f)})}return b.promise()},b.exports=new e},{"./app-bridge":12}],14:[function(a,b,c){"use strict";var d={ie:0,gecko:0,webkit:0,khtml:0,opera:0,ver:""},e={ie:0,firefox:0,safari:0,konq:0,opera:0,chrome:0,ver:""},f={win:!1,mac:!1,x11:!1,iPhone:!1,iPad:!1,iOS:!1,Android:!1,winPhone:!1},g=!1,h=navigator.userAgent,i=navigator.platform;if(/(Meiya(?:-dev)?)/.test(h)){var j=RegExp.$1;g={name:j,ver:/Meiya(?:-dev)?\/(\d+\.\d+\.\d+(?:\.\d+)?)\D/.exec(h)[1],isDev:/Meiya-dev/.test(j)}}if(f.win=0==i.indexOf("Win"),f.mac=0==i.indexOf("Mac"),f.x11=0==i.indexOf("X11")||0==i.indexOf("Linux"),f.win&&/Win(?:dows )?([^do]{2})\s?(\d+\.\d+)?/.test(h))if("NT"==RegExp.$1)switch(RegExp.$2){case"5.0":f.win="2000";break;case"5.1":f.win="XP";break;case"6.0":f.win="Vista";break;case"6.1":f.win="7";break;default:f.win="NT"}else"9x"==RegExp.$1?f.win="ME":f.win=RegExp.$1;if(f.iPhone=h.indexOf("iPhone")>-1,f.iPad=h.indexOf("iPad")>-1,f.mac&&h.indexOf("Mobile")>-1&&(/CPU (?:iPhone )?OS (\d+_\d+)/.test(h)?f.iOS=parseFloat(RegExp.$1.replace("_",".")):f.iOS=2),/Android (\d+\.\d+)/.test(h)&&(f.Android=parseFloat(RegExp.$1)),"CE"==f.win?f.winPhone=f.win:"Ph"==f.win&&/Windows Phone OS (\d+\.\d+)/.test(h)&&(f.win="Phone",f.winPhone=parseFloat(RegExp.$1)),window.opera)d.ver=e.ver=window.opera.version(),d.opera=e.opera=parseFloat(d.ver);else if(/AppleWebKit\/(\S+)/.test(h))if(d.ver=RegExp.$1,d.webkit=parseFloat(d.ver),/Chrome\/(\S+)/.test(h))e.ver=RegExp.$1,e.chrome=parseFloat(e.ver);else if(/Version\/(\S+)/.test(h))e.ver=RegExp.$1,e.safari=parseFloat(e.ver);else{var k=1;k=d.webkit<100?1:d.webkit<312?1.2:d.webkit<412?1.3:2,e.safari=e.ver=k}else/KHTML\/(\S+)/.test(h)||/Konqueror\/([^;]+)/.test(h)?(d.ver=e.ver=RegExp.$1,d.khtml=e.konq=parseFloat(d.ver)):/rv:([^\)]+)\) Gecko\/\d{8}/.test(h)?(d.ver=RegExp.$1,d.gecko=parseFloat(d.ver),/Firefox\/(\S+)/.test(h)&&(e.ver=RegExp.$1,e.firefox=parseFloat(e.ver))):/MISE ([^;]+)/.test(h)&&(d.ver=e.ver=RegExp.$1,d.ie=e.ie=parseFloat(d.ver));b.exports={engine:d,browser:e,system:f,app:g}},{}],15:[function(a,b,c){"use strict";var d=(a("./app-bridge"),a("./images")),e=$(window),f={elements:null,threshold:0,failure_limit:0,event:"scroll",effect:"show",container:window,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"},g=function(a,b){var c=this;"object"==typeof a&&(b=a,a=b.elements);var g=this.$elements=$(a);b=$.extend(f,b),b.elements||(b.elements=a),this.options=b;var h=this.$container=void 0===b.container||b.container===window?e:$(b.container);return 0===b.event.indexOf("scroll")&&h.on(b.event,function(){c.update()}),g.each(function(){var a=this,e=$(a);a.loaded=!1,(void 0===e.attr("src")||e.attr("src")===!1)&&e.is("img")&&e.attr("src",b.placeholder),e.one("appear",function(){if(!this.loaded){if(b.appear){var f=g.length;b.appear.call(a,f,b)}$("<img />").on("error",d.onerror).on("load",function(){var d=e.attr("data-"+b.data_attribute);e.hide(),e.is("img")?e.attr("src",d):e.css("background-image","url('"+d+"')"),e[b.effect](b.effect_speed),a.loaded=!0;var f=$.grep(g,function(a){return!a.loaded});if(g=c.$element=$(f),b.load){var h=g.length;b.load.call(a,h,b)}}).attr("src",e.attr("data-"+b.data_attribute))}}),0!==b.event.indexOf("scroll")&&e.on(b.event,function(){a.loaded||e.trigger("appear")})}),e.on("resize",function(){c.update()}),$(document).ready(function(){c.update()}),this};g.prototype={constructor:g,visible:function(a){return a=$(a),!(!a.width()&&!a.height())&&"none"!==a.css("display")},update:function(){var a=this,b=0,c=this.$elements,d=this.options;c.each(function(){var c=$(this);if(!d.skip_invisible||a.visible(this))if(a.abovethetop(this,d)||a.leftofbegin(this,d));else if(a.belowthefold(this,d)||a.rightoffold(this,d)){if(++b>d.failure_limit)return!1}else c.trigger("appear"),b=0})},abovethetop:function(a,b){var c;return c=void 0===b.container||b.container===window?e.scrollTop():$(b.container).offset().top,c>=$(a).offset().top+b.threshold+$(a).height()},leftofbegin:function(a,b){var c;return c=void 0===b.container||b.container===window?e.scrollLeft():$(b.container).offset().left,c>=$(a).offset().left+b.threshold+$(a).width()},belowthefold:function(a,b){var c;return c=void 0===b.container||b.container===window?(window.innerHeight?window.innerHeight:e.height())+e.scrollTop():$(b.container).offset().top+$(b.container).height(),
c<=$(a).offset().top-b.threshold},rightoffold:function(a,b){var c;return c=void 0===b.container||b.container===window?e.width()+e.scrollLeft():$(b.container).offset().left+$(b.container).width(),c<=$(a).offset().left-b.threshold}},b.exports=g},{"./app-bridge":12,"./images":13}]},{},[2]);