/* Meiya 2016-05-30 16:26 */!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=(MY.appBridge,MY.xhr),e={};e.user={id:0,data:null,getID:function(){var a=this,b=$.Deferred();return MY.appBridge.callHandler("get_user_id",function(c){a.id=c.user_id?+c.user_id:0,b.resolve(a.id)}),b.promise()},getData:function(a,b){var c=this;a=a||this.id;var e={url:"/v1/users/"+a,type:"get",success:function(a){c.data=a.data}};return"object"==typeof b&&(e.data=b),d.api(e)}},e.mission={data:null,getData:function(a,b){var c=this;return b=b||1,d.api({url:"/v1/mission",type:"get",data:{user_id:a,type:b},success:function(a){c.data=a.data}})}},b.exports=e},{}],2:[function(a,b,c){"use strict";var d=a("./common/common"),e=a("./tpl/template"),f=a("./tpl/detail/mission-logs.js"),g=a("./tpl/detail/point.js"),h=a("./tpl/detail/prize-logs.js"),i=MY,j=(i.appBridge,i.xhr),k={};e.helper("dateFormat",MY.dateFormat),k.user=d.user,k.user.init=function(a){var b=$.Deferred(),c=this;return this.data?b.resolve(this.data):this.getData(a).done(function(){b.resolve(c.data)}),b.promise()},k.missionLogs={data:null,getData:function(a){var b=$.Deferred(),c=this;return this.data?b.resolve(this.data):j.api({url:"/v1/mission-logs",type:"get",data:{user_id:a},success:function(a){c.data=a.data,b.resolve(c.data)}}),b.promise()},render:function(){document.getElementById("J_Lists").innerHTML=f({data:this.data})},init:function(a){a=a||k.user.id,k.user.init(a).done(function(a){var b=a.point;document.getElementById("J_Point").innerHTML=g({point:b,type:"mission"})}),this.getData(a).done(this.render.bind(this))}},k.prizeLogs={res:null,statusHash:{0:"已兑换",1:"已发货",2:"取消兑换"},getData:function(a){var b=$.Deferred(),c=this;return this.data?b.resolve(this.data):j.api({url:"/v1/prize-logs",type:"get",data:{user_id:a},success:function(a){c.res=a,b.resolve(c.res)}}),b.promise()},render:function(){var a=this.res;document.getElementById("J_Point").innerHTML=g({point:a.metadata.costPoints,type:"prize"}),document.getElementById("J_Lists").innerHTML=h({data:a.data,statusHash:this.statusHash})},init:function(a){a=a||k.user.id,this.getData(a).done(this.render.bind(this))}},k.tabs={active:"mission",$tabs:$("#J_Tabs .J_Tab"),$line:$("#J_TabsLine"),handler:function(a){this.active=a;var b=this.$line;this.$tabs.forEach(function(c,d){var e=$(c),f=c.dataset.tab;f===a?(e.addClass("active"),b.css({left:12.5+50*d+"%"})):e.removeClass("active")}),k[a+"Logs"].init()},init:function(){var a=this;this.$tabs.on("tap",function(){var b=this.dataset.tab;a.handler(b)})}},k.init=function(){var a=this;return this.tabs.init(),this.user.getID().done(function(b){a[a.tabs.active+"Logs"].init(b)})},k.init(),b.exports=k},{"./common/common":1,"./tpl/detail/mission-logs.js":3,"./tpl/detail/point.js":4,"./tpl/detail/prize-logs.js":5,"./tpl/template":6}],3:[function(a,b,c){"use strict";var d=a("../template");b.exports=d("detail/mission-logs",function(a){var b=this,c=b.$helpers,d=b.$each,e=a.data,f=(a.item,a.i,b.$string),g="";return d(e,function(a){g+=' <div class="item"> <table> <tbody> <tr> <td class="title">',g+=f(a.mission.title),g+='</td> <td rowspan="2" class="num ',g+=f(a.point>0?"green":"red"),g+='"> ',g+=f(a.point>0?"+":""),g+=f(a.point),g+='</td> </tr> <tr> <td class="time">',g+=f(c.dateFormat(1e3*a.created_time,"yyyy-MM-dd hh:mm")),g+="</td> </tr> </tbody> </table> </div> "}),new String(g)})},{"../template":6}],4:[function(a,b,c){"use strict";var d=a("../template");b.exports=d("detail/point",function(a){var b=this,c=(b.$helpers,a.type),d=b.$string,e=a.point,f="";return"mission"===c&&(f+=' <span>当前积分：</span> <i class="icon-coin-black"></i> <span>',f+=d(e),f+="</span> "),f+=" ","prize"===c&&(f+=' <span>已兑换积分：</span> <i class="icon-coin-black"></i> <span>',f+=d(e),f+="</span> "),new String(f)})},{"../template":6}],5:[function(a,b,c){"use strict";var d=a("../template");b.exports=d("detail/prize-logs",function(a){var b=this,c=b.$helpers,d=b.$each,e=a.data,f=(a.item,a.i,b.$string),g=a.statusHash,h="";return d(e,function(a){h+=' <div class="item"> <table> <tbody> <tr> <td class="title"> <p>',h+=f(a.prize.title),h+='</p> <p class="sub"> <span>',h+=f(g[a.status]),h+="</span> ",a.remark&&(h+=" <span>",h+=f(a.remark),h+="</span> "),h+=' </p> </td> <td rowspan="2" class="num red"> ',h+=f(a.point>0?"-":""),h+=f(a.point),h+='</td> </tr> <tr> <td class="time">',h+=f(c.dateFormat(1e3*a.created_time,"yyyy-MM-dd hh:mm")),h+="</td> </tr> </tbody> </table> </div> "}),new String(h)})},{"../template":6}],6:[function(a,b,c){"use strict";!function(){function a(a,b){return(/string|function/.test(typeof b)?i:h)(a,b)}function c(a,b){return"string"!=typeof a&&(b=typeof a,"number"===b?a+="":a="function"===b?c(a.call(a)):""),a}function d(a){return m[a]}function e(a){return c(a).replace(/&(?![\w#]+;)|[<>"']/g,d)}function f(a,b){if(n(a))for(var c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)}function g(a,b){var c=/(\/)[^\/]+\1\.\.\1/,d=("./"+a).replace(/[^\/]+$/,""),e=d+b;for(e=e.replace(/\/\.\//g,"/");e.match(c);)e=e.replace(c,"/");return e}function h(b,c){var d=a.get(b)||j({filename:b,name:"Render Error",message:"Template not found"});return c?d(c):d}function i(a,b){if("string"==typeof b){var c=b;b=function(){return new l(c)}}var d=k[a]=function(c){try{return new b(c,a)+""}catch(d){return j(d)()}};return d.prototype=b.prototype=o,d.toString=function(){return b+""},d}function j(a){var b="{Template Error}",c=a.stack||"";if(c)c=c.split("\n").slice(0,2).join("\n");else for(var d in a)c+="<"+d+">\n"+a[d]+"\n\n";return function(){return"object"==typeof console&&console.error(b+"\n\n"+c),b}}var k=a.cache={},l=window.String,m={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},n=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},o=a.utils={$helpers:{},$include:function(a,b,c){return a=g(c,a),h(a,b)},$string:c,$escape:e,$each:f},p=a.helpers=o.$helpers;a.get=function(a){return k[a.replace(/^\.\//,"")]},a.helper=function(a,b){p[a]=b},b.exports=a}()},{}]},{},[2]);