/* Meiya 2016-05-26 10:47 */!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){var c=b||window.location.search.substr(1),d=new RegExp(a+"=([^&#]+)","i"),e=c.match(d);return null!=e?decodeURI(RegExp.$1):null}var e=a("./tpl/template"),f=a("./tpl/index/main.js"),g=a("./tpl/index/intro.js"),h=a("../../public/src/ui/zepto.loading"),i=new h,j=MY.appBridge,k=(window.localStorage,$("#J_Intro")),l=$("#J_Main"),m=$("#J_Footer");e.helper("floor",function(a,b){return a+=1,b=10>a?"0"+a:a}),e.helper("content",function(a,b){return b=a?a.replace(/\n/gi,"</p><p>"):""});var n={_id:null,_user_id:0,favorite_id:null,init:function(){j.callHandler("get_user_id",function(a){n._user_id=a.user_id}),j.callHandler("get_query_string",function(a){n._id=d("id",a.query_string),n.loadPost().done(function(){i.hide().destory()})})},loadPost:function(){var a=$.Deferred(),b=function(a){n.intro.render(a),n.main.render(a),n.footer.render(a),j.callHandler("set_webview_title",{title:a.title})};return MY.xhr.ajax({type:"GET",url:"/api/features/"+n._id,headers:{"my-user-id":n._user_id},dataType:"json",success:function(c){var d=c.data;d?b(d):k.html("<p>小芽儿迷路了~</p>"),a.resolve()}}),a.promise()},intro:{render:function(a){k.html(g(a))}},main:{render:function(a){l.html(f(a)),this.event()},event:function(){l.delegate("a","tap",function(a){a.preventDefault();var b=$(this),c=b.attr("data-url");/meiya\:\/\//i.test(c)?j.callHandler("navi_page_action",c):j.callHandler("navi_webview_action",encodeURI(c))})}},footer:{render:function(a){m.show(),this.event(a)},event:function(a){var b=$("#J_BtnShare"),c=$("#J_BtnStar");n.favorite_id=a.favorite_id||null,n.favorite_id?(c.addClass("btn-stared"),c.removeClass("btn-star"),c.text("已收藏")):(c.addClass("btn-star"),c.removeClass("btn-stared"),c.text("收藏")),b.bind("tap",function(){var b=MY.locationOrigin+"/web_v2/gw.php?name=feature&id="+n._id;j.callHandler("share_channel_action",{default_share:{title:a.title,content:a.content,url:b,image_url:a.images[0].url},weibo:{title:a.title,content:a.content,url:b,image_url:a.images[0].url},favorite_id:n.favorite_id})}),c.bind("tap",function(){var a=$(this);n._user_id?a.hasClass("btn-star")||!n.favorite_id?j.callHandler("collect",{id:n._id,type:"Feature"},function(b){b.status&&(a.addClass("btn-stared"),a.removeClass("btn-star"),a.text("已收藏"),n.favorite_id=b.favorite_id)}):j.callHandler("cancel_collect",{favorite_id:n.favorite_id},function(b){a.addClass("btn-star"),a.removeClass("btn-stared"),a.text("收藏"),n.favorite_id=null}):j.callHandler("request_login")}),j.registerHandler("call_share_channel_action",function(){var b=MY.locationOrigin+"/web_v2/gw.php?name=feature&id="+n._id;j.callHandler("share_channel_action",{default_share:{title:a.title,content:a.content,url:b,image_url:a.images[0].url},weibo:{title:a.title,content:a.content,url:b,image_url:a.images[0].url},favorite_id:n.favorite_id})}),j.registerHandler("update_collect_state",function(a){a.favorite_id?(c.addClass("btn-stared"),c.removeClass("btn-star"),c.text("已收藏"),n.favorite_id=a.favorite_id):(c.addClass("btn-star"),c.removeClass("btn-stared"),c.text("收藏"),n.favorite_id=null)})}}};n.init()},{"../../public/src/ui/zepto.loading":5,"./tpl/index/intro.js":2,"./tpl/index/main.js":3,"./tpl/template":4}],2:[function(a,b,c){"use strict";var d=a("../template");b.exports=d("index/intro",function(a){var b=this,c=(b.$helpers,b.$each),d=a.images,e=(a.img,a.i,b.$string),f=a.content,g="";return g+='<div class="banner"> ',c(d,function(a){g+=" ",1==a.type&&(g+=' <img src="',g+=e(a.url),g+='?imageView2/2/w/640"> '),g+=" "}),g+=" </div> ",f&&(g+=" <p>",g+=e(f),g+="</p> "),g+=" ",new String(g)})},{"../template":4}],3:[function(a,b,c){"use strict";var d=a("../template");b.exports=d("index/main",function(a){var b=this,c=b.$helpers,d=b.$each,e=a.floors,f=(a.floor,a.$index,b.$string),g=(a.item,"");return d(e,function(a,b){g+=" ",a.items.length&&(g+=' <article class="article"> <div class="title"> <span class="floor">',g+=f(c.floor(b)),g+="</span> <h3>",g+=f(a.title),g+='</h3> </div> <div class="content"> ',a.content&&(g+=' <span class="pink">小芽推荐：</span>',g+=f(a.content),g+=" "),g+=" </div> ",d(a.items,function(a){g+=' <div class="product"> ',"Tutorial"==a.contextable_type?(g+=' <a data-url="meiya://tutorials/',g+=f(a.contextable_id),g+='"> '):"Post"==a.contextable_type?(g+=' <a data-url="meiya://posts/',g+=f(a.contextable_id),g+='"> '):"Good"==a.contextable_type?(g+=' <a data-url="meiya://goods/',g+=f(a.contextable_id),g+='"> '):"Trial"==a.contextable_type?(g+=' <a data-url="meiya://trials/',g+=f(a.contextable_id),g+='"> '):(g+=' <a data-url="',g+=f(a.url),g+='"> '),g+=' <div class="img"> ',a.images.length&&(g+=' <img src="',g+=f(a.images[0].url),g+='?imageView2/2/w/600"> '),g+=" </div> ",a.content&&(g+=' <div class="info"> ',a.user&&(g+=' <div class="author"> <span class="avatar"> <img src=\'',g+=f(a.user.avatar_url),g+='?imageView2/2/w/60\'> </span> <span class="name">',g+=f(a.user.username),g+="</span> </div> "),g+=' <blockquote class="quote"> <p>',g+=f(c.content(a.content)),g+="</p> </blockquote> </div> "),g+=" </a> </div> "}),g+=" </article> "),g+=" "}),new String(g)})},{"../template":4}],4:[function(a,b,c){"use strict";!function(){function a(a,b){return(/string|function/.test(typeof b)?i:h)(a,b)}function c(a,b){return"string"!=typeof a&&(b=typeof a,"number"===b?a+="":a="function"===b?c(a.call(a)):""),a}function d(a){return m[a]}function e(a){return c(a).replace(/&(?![\w#]+;)|[<>"']/g,d)}function f(a,b){if(n(a))for(var c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)}function g(a,b){var c=/(\/)[^\/]+\1\.\.\1/,d=("./"+a).replace(/[^\/]+$/,""),e=d+b;for(e=e.replace(/\/\.\//g,"/");e.match(c);)e=e.replace(c,"/");return e}function h(b,c){var d=a.get(b)||j({filename:b,name:"Render Error",message:"Template not found"});return c?d(c):d}function i(a,b){if("string"==typeof b){var c=b;b=function(){return new l(c)}}var d=k[a]=function(c){try{return new b(c,a)+""}catch(d){return j(d)()}};return d.prototype=b.prototype=o,d.toString=function(){return b+""},d}function j(a){var b="{Template Error}",c=a.stack||"";if(c)c=c.split("\n").slice(0,2).join("\n");else for(var d in a)c+="<"+d+">\n"+a[d]+"\n\n";return function(){return"object"==typeof console&&console.error(b+"\n\n"+c),b}}var k=a.cache={},l=window.String,m={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},n=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},o=a.utils={$helpers:{},$include:function(a,b,c){return a=g(c,a),h(a,b)},$string:c,$escape:e,$each:f},p=a.helpers=o.$helpers;a.get=function(a){return k[a.replace(/^\.\//,"")]},a.helper=function(a,b){p[a]=b},b.exports=a}()},{}],5:[function(a,b,c){"use strict";var d={elem:".J_Loading",onshow:function(){},onhide:function(){}},e='<div class="J_Loading loading"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>',f=function(a){var b=null;a=$.extend(d,a||{}),$.extend(this,a),b=$(a.elem),0===b.length&&(b=$(e),document.body.appendChild(b[0])),this.$elem=b},g=f.prototype={constructor:f};$.extend(g,{show:function(){return this.$elem.show(),this.__dispatchEvent("show"),this},hide:function(){return this.$elem.hide(),this.__dispatchEvent("hide"),this},__dispatchEvent:function(a,b){this["on"+a]&&this["on"+a](b)},destory:function(){this.$elem.remove();for(var a in this)delete this[a];return this}}),b.exports=f},{}]},{},[1]);