/* Meiya 2016-05-26 10:47 */!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("./tpl/brand"),e=a("./tpl/goods"),f=(a("./tpl/tip"),a("../../public/src/ui/zepto.search")),g=MY.appBridge,h=($(".container"),$("#J_Content")),i=null,j=null,k={__brandId:null,__goodsId:null,init:function(){this.inner()},inner:function(){var a=this;setTimeout(function(){i=$("#J_BrandInput"),j=$("#J_GoodsInput"),MY.isiPhone?i.focus():i.attr("autofocus","autofocus"),a.Input.init(),a.Handler.init(),a.BrandHot.init(1)},500)},Input:{init:function(){new f({input:"#J_BrandInput",enter:function(a){a.replace(/([^\x00-\xff])/g,"**").length<=40?(j.parent().hasClass("disabled")&&j.parent().removeClass("disabled"),k.BrandHot.init(0,a)):(this.$input.val(a.substr(0,40)),this.$input.blur(),g.callHandler("my_toast",{delay:1,content:"文字超出，最多支持20个中文字符"}))},empty:function(){j.parent().addClass("disabled"),k.__brandId=null,k.BrandHot.init(1)},onfocus:function(a){var b=a.target.value;b?k.BrandHot.init(0,b):k.BrandHot.init(1)}}),new f({input:"#J_GoodsInput",enter:function(a){a.replace(/([^\x00-\xff])/g,"**").length<=40?k.GoodsHot.init(0,k.__brandId,a):(this.$input.val(a.substr(0,40)),this.$input.blur(),g.callHandler("my_toast",{delay:1,content:"文字超出，最多支持20个中文字符"}))},empty:function(){k.GoodsHot.init(1,k.__brandId)},onfocus:function(a){if(k.__autoFocus)this.$input.val("");else{var b=a.target.value;k.BrandHot.loadBrandList(0,i.val()).done(function(a){1===a.data.length?(k.__brandId=a.data[0].id,b?k.GoodsHot.init(0,k.__brandId,b):k.GoodsHot.init(1,k.__brandId)):h.html("")})}delete k.__autoFocus}})}},BrandHot:{init:function(a,b){this.isHot=a,a?(this.render(),this.touch()):this.loadBrandList(a,b).done(function(){this.render(),this.touch()}.bind(this))},touch:function(){h.find("li").bind("tap",function(){var a=$(this),b=a.find(".name").text()||a.find("span").text(),c=a.attr("data-id");i.val(b),j.parent().removeClass("disabled"),k.__autoFocus=!0,j.focus(),k.GoodsHot.init(1,c),k.__brandId=c})},loadBrandList:function(a,b){var c=a?{is_hot:a}:{key:b};return MY.xhr.get("/api/brands",c,function(b){a?this._hotData=b.data:this._data=b.data}.bind(this))},render:function(){var a=this.isHot;h.html(d({isHot:a,data:a?{}:this._data}))}},GoodsHot:{init:function(a,b,c){this.isHot=a,this.loadGoodsList(a,b,c).done(function(){this.render(),this.touch()}.bind(this))},touch:function(){var a=i.val();k.__brandId;h.find("li").bind("tap",function(){var b=$(this),c=b.find(".title").text();i.val(a),j.val(c),k.__goodsId=b.attr("data-id")})},loadGoodsList:function(a,b,c){var d=a?{brand_id:b,is_hot:a}:{brand_id:b,key:c};return MY.xhr.get("/api/products",d,function(a){this._data=a.data}.bind(this))},render:function(){var a=this.isHot;h.html(e({isHot:a,data:this._data}))}},Handler:{init:function(){g.callHandler("init_good_brand",function(a){var b=a.brand.name||"",c=a.product.name||"";i.val(b),j.val(c),b&&j.parent().removeClass("disabled")}),this.register()},register:function(){g.registerHandler("confirm_add_good_brand",function(a){i.blur(),j.blur();var b=i.val(),c=j.val();if(b.replace(/([^\x00-\xff])/g,"**").length>40||c.replace(/([^\x00-\xff])/g,"**").length>40)return g.callHandler("my_toast",{delay:1,content:"文字超出，最多支持20个中文字符"}),!1;var d={brand:{id:k.__brandId||0,name:b},product:{id:k.__goodsId||0,name:c}};b?k.Handler.call(d):g.callHandler("my_toast",{delay:1,content:"请输入品牌名~"})})},call:function(a){g.callHandler("add_good_brand",a)}}};k.init()},{"../../public/src/ui/zepto.search":6,"./tpl/brand":2,"./tpl/goods":3,"./tpl/tip":5}],2:[function(a,b,c){"use strict";var d=a("./template");b.exports=d("brand",function(a){var b=this,c=(b.$helpers,a.isHot),d=b.$each,e=a.data,f=(a.value,a.i,b.$string),g="";return g+='<div id="J_Lists" class="brand-lists"> ',c?g+=' <div class="title">输入准确商品信息更容易获得小芽的推荐哦</div> ':(g+=' <div class="content"> <ul> ',d(e,function(a){g+=" ",a&&(g+=' <li class="list" data-id=\'',g+=f(a.id),g+="'> ",a.name?(g+=' <span class="name">',g+=f(a.name),g+="</span> ",a.name==a.zh_name?(g+=" <span>",g+=f(a.en_name),g+="</span> "):(g+=" <span>",g+=f(a.zh_name),g+="</span> "),g+=" "):(g+=" ",a.zh_name&&(g+=" <span>",g+=f(a.zh_name),g+="</span> "),g+=" ",a.en_name&&(g+=" <span>",g+=f(a.en_name),g+="</span> "),g+=" "),g+=" </li> "),g+=" "}),g+=" </ul> </div> "),g+=" </div>",new String(g)})},{"./template":4}],3:[function(a,b,c){"use strict";var d=a("./template");b.exports=d("goods",function(a){var b=this,c=(b.$helpers,a.isHot),d=b.$each,e=a.data,f=(a.$value,a.$index,b.$string),g="";return g+='<div id="J_Lists" class="goods-lists"> ',c&&(g+=' <div class="title">热门商品</div> '),g+=' <div class="content"> <ul> ',d(e,function(a){g+=" ",a&&(g+=' <li class="list" data-id=\'',g+=f(a.id),g+='\'> <div class="img-wrap"> ',a.images&&a.images.length?(g+=' <img src="',g+=f(a.images[0].url),g+='?imageView2/1/h/70" alt=""> '):g+=' <img src="./img/default.png" alt=""> ',g+=' </div> <div class="title">',g+=f(a.name),g+="</div> </li> "),g+=" "}),g+=" </ul> </div> </div>",new String(g)})},{"./template":4}],4:[function(a,b,c){"use strict";!function(){function a(a,b){return(/string|function/.test(typeof b)?i:h)(a,b)}function c(a,b){return"string"!=typeof a&&(b=typeof a,"number"===b?a+="":a="function"===b?c(a.call(a)):""),a}function d(a){return m[a]}function e(a){return c(a).replace(/&(?![\w#]+;)|[<>"']/g,d)}function f(a,b){if(n(a))for(var c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)}function g(a,b){var c=/(\/)[^\/]+\1\.\.\1/,d=("./"+a).replace(/[^\/]+$/,""),e=d+b;for(e=e.replace(/\/\.\//g,"/");e.match(c);)e=e.replace(c,"/");return e}function h(b,c){var d=a.get(b)||j({filename:b,name:"Render Error",message:"Template not found"});return c?d(c):d}function i(a,b){if("string"==typeof b){var c=b;b=function(){return new l(c)}}var d=k[a]=function(c){try{return new b(c,a)+""}catch(d){return j(d)()}};return d.prototype=b.prototype=o,d.toString=function(){return b+""},d}function j(a){var b="{Template Error}",c=a.stack||"";if(c)c=c.split("\n").slice(0,2).join("\n");else for(var d in a)c+="<"+d+">\n"+a[d]+"\n\n";return function(){return"object"==typeof console&&console.error(b+"\n\n"+c),b}}var k=a.cache={},l=window.String,m={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},n=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},o=a.utils={$helpers:{},$include:function(a,b,c){return a=g(c,a),h(a,b)},$string:c,$escape:e,$each:f},p=a.helpers=o.$helpers;a.get=function(a){return k[a.replace(/^\.\//,"")]},a.helper=function(a,b){p[a]=b},b.exports=a}()},{}],5:[function(a,b,c){"use strict";var d=a("./template");b.exports=d("tip",function(a){var b=this,c=(b.$helpers,b.$string),d=a.data,e="";return e+='<div id="tip" class="tip"> <span>',e+=c(d),e+="</span> </div>",new String(e)})},{"./template":4}],6:[function(a,b,c){"use strict";var d="search",e={elem:".J_SearchBox",input:null,enter:function(){},empty:function(){},onsubmit:function(){},onfocus:function(){}},f=function(a){a=$.extend(e,a||{}),$.extend(this,a);var b=this.$elem=$(a.elem),c=this.$form=b.find("form"),f=this.$input=a.input?$(a.input):b.find(".input"),g=this.$clear=b.find(".J_Clear");$(document).off("touchmove."+d).on("touchmove."+d,$.proxy(this.blur,this)),$(document).off("touchend."+d).on("touchend."+d,$.proxy(this.blur,this)),f.on("touchmove",function(a){a.stopPropagation()}),f.on("touchend",function(a){a.stopPropagation()}),c.on("submit",$.proxy(this.submit,this)),f.on("focus",$.proxy(this.focus,this)),f.on("input",$.proxy(this.__toggle,this)),g.length&&g.on("touchstart, click",$.proxy(this.clear,this))},g=f.prototype={constructor:f};$.extend(g,{blur:function(){this.$input.blur()},focus:function(a){this.__dispatchEvent("focus",a)},__toggle:function(){var a=this.$input,b=this.$clear,c=a[0].value;c?(b.addClass("active"),this.enter(c)):(b.removeClass("active"),this.empty())},submit:function(a){this.blur(),this.__dispatchEvent("submit",a)},clear:function(){var a=this.$input,b=this.$clear;a[0].value="",b.removeClass("active"),this.empty()},__dispatchEvent:function(a,b){this["on"+a]&&this["on"+a](b)},destory:function(){}}),b.exports=f},{}]},{},[1]);